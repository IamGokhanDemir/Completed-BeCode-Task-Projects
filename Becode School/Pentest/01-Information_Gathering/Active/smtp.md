# 📧 SMTP Enumeration

## 🤔 What is an SMTP Server?

An SMTP (Simple Mail Transfer Protocol) server is like the postal service of the digital world. It's responsible for routing emails from a sender to one or more recipients across the Internet, following the rules of the SMTP network protocol. SMTP servers play a vital role in preventing spam through authentication mechanisms, ensuring that only authorized users can send emails. To achieve this, most modern mail servers support the ESMTP protocol extension with SMTP-AUTH.

In the email transmission process, SMTP servers act as relays, connecting the sender's outgoing mail server, one or more external transfer servers, and the recipient's incoming mail server. Here's a breakdown of their functions:

### 1. Outgoing Mail Server of the Sender

- When a sender sends an email, their email program (SMTP client or MUA - Mail User Agent) converts it into a header and a body.
- This email is then loaded onto the sender's outgoing mail server, which is an SMTP server.
- The outgoing mail server, equipped with a Mail Transfer Agent (MTA), checks the email for size and spam and logs it.
- Sometimes, a Mail Submission Agent (MSA) is installed upstream to validate the email's validity before reaching the MTA.
- The MTA then looks up the IP address of the recipient's mail server in the Domain Name System (DNS).

### 2. External Transfer Server

- If the recipient's domain is connected to the same mail server as the sender, the email is delivered directly.
- However, if they are not connected, the MTA divides the email into small data packets, which are sent to the target SMTP server via the shortest route with the least traffic.
- These packets may pass through several external SMTP servers (known as "Relays"), which take over the continuous transfer.

### 3. Recipient's Incoming Mail Server

- Upon arrival at the recipient's SMTP server, the data packets are reassembled into a complete email.
- The MSA and/or MTA rechecks it for spam and then transfers it to the message store of the inbox server.
- From there, the Mail Delivery Agent (MDA) forwards it to the recipient's inbox.
- Subsequently, other network protocols like IMAP or POP3 download the emails to the recipient's SMTP client.

SMTP servers provide an advantage: if the recipient's incoming mail server is busy or temporarily down and email delivery fails, the responsible SMTP server automatically retries at regular intervals. This continues until successful delivery or until the email is marked as undelivered and returned to the sender.

📖 To understand more about SMTP enumeration, read this documentation: [SMTP Enumeration Guide](https://pentestmonkey.net/tools/user-enumeration/smtp-user-enum).

## 🏋️‍♂️ Exercises

**Note**: Make sure you're connected to the VPN for these exercises, and use the provided IP address (10.12.1.36).

1. **How many commands are allowed on port 25?**
    > Your response 

2. **How many users can you enumerate via port 25?**
    > Your response 

3. **Send an email from the address admin@local to root@local by connecting to the SMTP server.**
    > Your response 

4. **Connect to SSH with the credentials msfadmin:msfadmin and check if you have sent the email.**
    > Your response 

Let's see how you did!

# ✅ Answers

1. **How many commands are allowed on port 25?**
    > Your response 

2. **How many users can you enumerate via port 25?**
    > Your response 

3. **Send an email from the address admin@local to root@local by connecting to the SMTP server.**
    > Your response 

4. **Connect to SSH with the credentials msfadmin:msfadmin and check if you have sent the email.**
    > Your response 

Let's check your answers!