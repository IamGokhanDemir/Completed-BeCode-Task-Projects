# DNS Enumeration: Revealing the Secrets of DNS 🌐🔍

> The Domain Name System (DNS) is like the internet's phonebook. It's a hierarchical and decentralized naming system used to identify computers on the internet. DNS associates user-friendly domain names with numerical IP addresses that computers use to find each other. While DNS is mainly used for this translation, it serves many other functions and has been crucial to the internet's operation since 1985.

📚 **Source**: Wikipedia

## DNS Enumeration: Unveiling the DNS World 🕵️‍♂️

DNS enumeration is like exploring all the hidden corners of DNS to find every server and its records within an organization. Companies have internal and external DNS servers that can reveal valuable information like usernames, computer names, and IP addresses of potential targets. Various tools, such as NSlookup, DNSstuff, American Registry for Internet Numbers (ARIN), and Whois, can be used for DNS enumeration. To become a DNS enumeration pro, you need a solid understanding of how DNS works and knowledge of different DNS records.

🔍 **You should understand DNS records**, which are like the different pieces of information stored in DNS databases. DNS is like a distributed, hierarchical, and fail-safe database that keeps track of internet domain names and their corresponding addresses. There are several types of DNS records, each with its purpose:

| **DNS Record Types** | 🧰 **Method** | 📝 **Description** |
| --------------------- | --------------- | ------------------- |
| dns query | A | **Address record**: It returns a 32-bit IPv4 address, usually used to translate hostnames to IP addresses but has other uses too. |
| dns query | CNAME | **Canonical name record**: It creates an alias from one name to another. If you look up a name, it continues searching using the new name. |
| dns query | AAAA | **IPv6 address record**: This returns a 128-bit IPv6 address, used for translating hostnames to IPv6 addresses. |
| dns query | MX | **Mail exchange record**: This maps a domain name to a list of email servers responsible for receiving emails for that domain. |
| dns query | NS | **Name server record**: It delegates a DNS zone to authoritative name servers that are responsible for that zone. |
| dns query | SOA | **Zone of authority record**: This provides authoritative information about a DNS zone, including the primary name server, domain administrator's email, and other zone-related timers. |
| dns query | SPF | **Sender Policy Framework**: A system to validate emails and detect email spoofing by allowing mail servers to check if emails come from authorized hosts. |
| dns query | TXT | **Text record**: Originally used for arbitrary human-readable text in a DNS record. |
| dns query | PTR | **Pointer record**: It's mainly used for reverse DNS lookups but also has other uses like DNS-SD. |
| dns query | SRV | **Service locator**: This is a generalized service location record used for newer protocols instead of creating protocol-specific records like MX. |
| dns query | NSEC | **Next Secure record**: Part of DNSSEC, used to prove that a specific name doesn't exist. |
| dns query | AXFR | **Authoritative Zone Transfer**: It transfers the entire zone file from the master name server to secondary name servers, commonly used for replicating DNS data or backup. |
| dns query | IXFR | **Incremental Zone Transfer**: Similar to AXFR but transfers only the changes made to the zone. |
| dns query | DNS Wildcard | It checks if the nameserver enables wildcard queries. |
| dns query | Domain Bruteforce | This performs brute force subdomain searches using wordlists. |
| dns query | Reverse Bruteforce | It conducts reverse IP lookups for a given domain. |
| dns query | SRV Bruteforce | It brute forces SRV records. |
| dns query | GTLD Bruteforce | It brute forces GTLD records. |
| dns query | TLD Bruteforce | It brute forces TLD records. |

## 📚 Explore the Following Documentation 📚

1. [DNS in Detail on TryHackMe](https://tryhackme.com/room/dnsindetail)
2. [DNS Enumeration on SecurityTrails](https://securitytrails.com/blog/dns-enumeration)
3. [Recon-NG Tutorial](https://hackertarget.com/recon-ng-tutorial/)
4. [TheHarvester Tutorial on GeeksforGeeks](https://www.geeksforgeeks.org/python-theharvester-how-to-use-it/)

## Exercises: Let's Get Hands-On! 💪

⚠️⚠️⚠️ Remember to save your answers. Your coaches may ask for them at the end of the challenge. ⚠️⚠️⚠️

1. What is the IP address of adlp-corp.com?
    > **Your response:** 17.29.24.1
    > **Your command:** with the following command in the Kali Linux command line you can find the answer *nslookup adlp-corp.com*

2. What is the TXT record of adlp-corp.com?
    > **Your response:** BC{DESCRIPTIVE-DOMAIN-TXT}
    > **Your command:** Kalin Linux command line: *nslookup -type=TXT adlp-corp.com*

3. What are the MX records of becode.org?
    > **Your response:** mail exchanger = 1 aspmx.l.google.com
    > **Your command:** nslookup -type=MX becode.org

4. What are the MX records of adlp-corp.com?
    > **Your response:** aspmx.l.google.com.
    > **Your command:** nslookup -type=MX adlp-corp.com

5. What is the first NS name server of adlp-corp.com?
    > **Your response:** ns-269.awsdns-33.com
    > **Your command:** nslookup -type=CNAME adlp-corp.com

6. Use a brute force tool to find subdomains of adlp-corp.com. How many did you find?
    > **Your response:** 
    > **Your command:** 

7. Use theHarvester tool on becode.org. How many LinkedIn users did you find?
    > **Your response:** tool does not  work (properly to many request)
    > **Your command:**  theHarvester -d becode.org -b linkedin

8. Use theHarvester tool on becode.org. How many IP addresses did you find?
    > **Your response:** No ip found
    > **Your command:**  theHarvester -d becode.org 

9. Write a small script to attempt a zone transfer from adlp-corp.com using a higher-level scripting language such as Python, Perl, or Ruby.
    > **Your Script:** 
```

import dns.resolver

import dns.query

import dns.zone

  

domain = 'adlp-corp.com'

try:

    ns = dns.resolver.resolve(domain, 'NS')

    nameserver = str(ns[0])

    zone = dns.zone.from_xfr(dns.query.xfr(nameserver, domain))

    for name, node in zone.nodes.items():

        rdatasets = node.rdatasets

        print(f'{name} {rdatasets}')

except dns.exception.DNSException as e:

    print(f'An error occurred: {e}')
    
```

Breakdown of the code:

1. **Importing Modules**:
   ```python
   import dns.resolver
   import dns.query
   import dns.zone
   ```
   These lines import Python modules that allow you to work with DNS (Domain Name System) data.

2. **Defining the Domain**:
   ```python
   domain = 'adlp-corp.com'
   ```
   Here, you're setting the `domain` variable to the domain name 'adlp-corp.com'. This is the domain for which you want to retrieve DNS information.

3. **Performing a DNS Zone Transfer**:
   ```python
   try:
       ns = dns.resolver.resolve(domain, 'NS')
       nameserver = str(ns[0])
       zone = dns.zone.from_xfr(dns.query.xfr(nameserver, domain))
   ```
   This section does the following:
   - It queries DNS servers to find out which DNS servers are responsible for the 'adlp-corp.com' domain (the name servers).
   - It selects the first name server from the list and converts it to a string, storing it in the `nameserver` variable.
   - It attempts to retrieve all DNS records (zone transfer) for the 'adlp-corp.com' domain using the selected name server.
   - The result of this zone transfer is stored in the `zone` variable, which now contains all DNS records for 'adlp-corp.com'.

4. **Iterating Through DNS Records**:
   ```python
       for name, node in zone.nodes.items():
           rdatasets = node.rdatasets
           print(f'{name} {rdatasets}')
   ```
   This part does the following:
   - It loops through all the DNS records found in the `zone` object.
   - For each DNS record, it retrieves the name (e.g., 'www' or 'mail') and the associated data (rdatasets) which contain things like IP addresses.
   - It prints the name and the associated data (rdatasets) for each DNS record.

5. **Handling Exceptions**:
   ```python
   except dns.exception.DNSException as e:
       print(f'An error occurred: {e}')
   ```
   This part handles any errors that may occur during the DNS operations. If something goes wrong, it prints an error message that includes information about what went wrong (stored in the variable `e`).

In summary, this code is designed to fetch and display all the DNS records associated with the 'adlp-corp.com' domain. DNS records provide information like which IP addresses are associated with specific domain names. The code uses the `dnspython` library to interact with DNS servers, perform a zone transfer, and then display the DNS records.

10. Write a small script to attempt a brute force search for subdomains using a higher-level scripting language such as Python, Perl, or Ruby.
    > **Your Script:** 
   ```

    # Import the dns.resolver module. This module provides an interface to domain name service (DNS) resolution.
import dns.resolver

# Define a function to perform a brute force search for subdomains.
def brute_force_subdomains(domain, wordlist):
    # Initialize an empty list to store found subdomains.
    found_subdomains = []
    
    # Open the wordlist file and read it line by line.
    with open(wordlist, 'r') as file:
        for line in file:
            # Construct a potential subdomain by appending the domain to the current line.
            subdomain = f'{line.strip()}.{domain}'
            
            try:
                # Attempt to resolve the DNS A record for the potential subdomain.
                dns.resolver.query(subdomain, 'A')
                
                # If the resolution is successful, add the subdomain to the list of found subdomains and print it.
                found_subdomains.append(subdomain)
                print(f'Found: {subdomain}')
            except:
                # If the resolution fails (i.e., the subdomain does not exist), do nothing and move on to the next line.
                pass
    
    # Return the list of found subdomains.
    return found_subdomains

# Example usage
# Specify the domain and wordlist file.
domain = 'example.com'
wordlist = 'subdomains.txt'

### Call the brute_force_subdomains function and store the result in a variable.
found_subdomains = brute_force_subdomains(domain, wordlist)

```

The provided Python script is designed to perform a brute-force search for subdomains of a given domain using a wordlist. Here's a breakdown of the script's components and what each part does:

```python
# Import the dns.resolver module. This module provides an interface to domain name service (DNS) resolution.
import dns.resolver

# Define a function to perform a brute force search for subdomains.
def brute_force_subdomains(domain, wordlist):
    # Initialize an empty list to store found subdomains.
    found_subdomains = []

    # Open the wordlist file and read it line by line.
    with open(wordlist, 'r') as file:
        for line in file:
            # Construct a potential subdomain by appending the domain to the current line.
            subdomain = f'{line.strip()}.{domain}'

            try:
                # Attempt to resolve the DNS A record for the potential subdomain.
                dns.resolver.query(subdomain, 'A')

                # If the resolution is successful, add the subdomain to the list of found subdomains and print it.
                found_subdomains.append(subdomain)
                print(f'Found: {subdomain}')
            except:
                # If the resolution fails (i.e., the subdomain does not exist), do nothing and move on to the next line.
                pass

    # Return the list of found subdomains.
    return found_subdomains

# Example usage
# Specify the domain and wordlist file.
domain = 'example.com'
wordlist = 'subdomains.txt'

# Call the brute_force_subdomains function and store the result in a variable.
found_subdomains = brute_force_subdomains(domain, wordlist)
```

Here's what each part of the code does:

1. **Importing the `dns.resolver` Module**:
   - The script starts by importing the `dns.resolver` module, which provides functionality for DNS resolution.

2. **Defining the `brute_force_subdomains` Function**:
   - This function is defined to perform the brute force search for subdomains. It takes two parameters: `domain` (the target domain to search for subdomains) and `wordlist` (the file containing potential subdomains).

3. **Initializing an Empty List for Found Subdomains**:
   - An empty list called `found_subdomains` is initialized to store the subdomains that are found during the search.

4. **Opening and Reading the Wordlist File**:
   - The script opens the specified `wordlist` file in read mode and iterates through its lines.

5. **Constructing Potential Subdomains**:
   - For each line in the wordlist, a potential subdomain is constructed by appending it to the `domain`. For example, if the wordlist contains "www," it would try to resolve "www.example.com."

6. **Performing DNS Queries**:
   - Inside a `try` block, the script attempts to resolve the DNS `A` record for the potential subdomain using `dns.resolver.query()`. If the DNS resolution is successful, it means the subdomain exists.

7. **Adding Found Subdomains and Printing**:
   - If the DNS query is successful, the subdomain is added to the `found_subdomains` list, and it is printed to the console.

8. **Handling Exceptions**:
   - If the DNS query fails (i.e., the subdomain does not exist), the script catches the exception and continues to the next line in the wordlist.

9. **Returning the List of Found Subdomains**:
   - After processing all potential subdomains, the function returns the list of found subdomains.

10. **Example Usage**:
    - The script specifies the target `domain` ('example.com') and the `wordlist` file ('subdomains.txt') to use for the search. It then calls the `brute_force_subdomains` function and stores the result in the `found_subdomains` variable.

This script is meant for educational purposes and should only be used with proper authorization, as performing a brute force subdomain search without permission may violate the terms of service of the domain owner or hosting provider.

## Resources 📖

- [List of DNS Record Types](https://en.wikipedia.org/wiki/List_of_DNS_record_types)
- [Exploit-DB Documentation](https://www.exploit-db.com/docs/12389.pdf)
- [Pentestlab DNS Enumeration](https://pentestlab.blog/tag/dns-enumeration/)
- [DNSRecon Tool](http://tools.kali.org/information-gathering/dnsrecon)
- [GitHub - DNS Enumeration Scripts](https://github.com/nixawk/ig/)